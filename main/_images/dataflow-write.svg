<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 550 670" width="550" height="670">
  <defs>
    <style>
      .box { fill: #f0f8ff; stroke: #4682b4; stroke-width: 2; }
      .user { fill: #e8f5e9; }
      .hw { fill: #fff3e0; }
      .text { font-family: Arial, sans-serif; font-size: 13px; text-anchor: middle; }
      .code { font-family: 'Courier New', monospace; font-size: 12px; text-anchor: middle; fill: #666; }
      .arrow { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333" />
    </marker>
  </defs>

  <text class="text" x="275" y="20" font-weight="bold" font-size="16">Writing a Register</text>

  <!-- User -->
  <rect class="box user" x="100" y="40" width="350" height="40" rx="5" />
  <text class="text" x="275" y="65">User → caput ZEBRA:SoftIn 5</text>
  <line class="arrow" x1="275" y1="80" x2="275" y2="105" />

  <!-- FastCS EPICS Transport -->
  <rect class="box" x="100" y="110" width="350" height="40" rx="5" />
  <text class="text" x="275" y="135">FastCS EPICS Transport</text>
  <line class="arrow" x1="275" y1="150" x2="275" y2="175" />

  <!-- ZebraController.soft_in -->
  <rect class="box" x="100" y="180" width="350" height="40" rx="5" />
  <text class="text" x="275" y="205">ZebraController.soft_in attribute</text>
  <line class="arrow" x1="275" y1="220" x2="275" y2="245" />

  <!-- ZebraRegisterIO.send -->
  <rect class="box" x="100" y="250" width="350" height="40" rx="5" />
  <text class="text" x="275" y="275">ZebraRegisterIO.send(attr, value=5)</text>
  <line class="arrow" x1="275" y1="290" x2="275" y2="315" />

  <!-- ZebraProtocol.write_register -->
  <rect class="box" x="100" y="320" width="350" height="40" rx="5" />
  <text class="text" x="275" y="345">ZebraProtocol.write_register(0x7F, 5)</text>
  <line class="arrow" x1="275" y1="360" x2="275" y2="385" />

  <!-- ZebraTransport.send_line -->
  <rect class="box" x="100" y="390" width="350" height="40" rx="5" />
  <text class="text" x="275" y="410">ZebraTransport.send_line("W7F0005\n")</text>
  <line class="arrow" x1="275" y1="430" x2="275" y2="455" />

  <!-- Serial Hardware -->
  <rect class="box hw" x="100" y="460" width="350" height="40" rx="5" />
  <text class="text" x="275" y="485">Serial Hardware</text>
  <line class="arrow" x1="275" y1="500" x2="275" y2="525" />

  <!-- ZebraTransport.receive_line -->
  <rect class="box" x="100" y="530" width="350" height="40" rx="5" />
  <text class="text" x="275" y="550">ZebraTransport.receive_line() → "W7FOK\n"</text>
  <line class="arrow" x1="275" y1="570" x2="275" y2="595" />

  <!-- ZebraProtocol validates -->
  <rect class="box" x="100" y="600" width="350" height="40" rx="5" />
  <text class="text" x="275" y="625">ZebraProtocol validates response</text>
  <line class="arrow" x1="100" y1="620" x2="20" y2="620" />
  <line class="arrow" x1="20" y1="620" x2="20" y2="130" />
  <line class="arrow" x1="20" y1="130" x2="80" y2="130" />

  <!-- Return path label -->
  <text class="text" x="40" y="370" font-size="11" text-anchor="start" transform="rotate(-90 40 370)">Success confirmation</text>
</svg>
