
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Zebra Serial Protocol Specification &#8212; fastcs-zebra 0.1.dev8+g7327b36e2 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=864b65f2"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=30646c52"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'reference/serial-protocol';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://DiamondLightSource.github.io/fastcs-zebra/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'main';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
    <link rel="icon" href="../_static/dls-logo.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Zebra EPICS PV Interface Specification" href="epics-pv-spec.html" />
    <link rel="prev" title="Reference" href="../reference.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="main" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/dls-logo.svg" class="logo__image only-light" alt=""/>
    <img src="../_static/dls-logo.svg" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">fastcs-zebra</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../tutorials.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../how-to.html">
    How-to Guides
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../explanations.html">
    Explanations
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../reference.html">
    Reference
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/DiamondLightSource/fastcs-zebra" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/fastcs-zebra" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-cube fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../tutorials.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../how-to.html">
    How-to Guides
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../explanations.html">
    Explanations
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../reference.html">
    Reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/DiamondLightSource/fastcs-zebra" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/fastcs-zebra" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-cube fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Zebra Serial Protocol Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="epics-pv-spec.html">Zebra EPICS PV Interface Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_api/fastcs_zebra.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/DiamondLightSource/fastcs-zebra/releases">Release Notes</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../reference.html" class="nav-link">Reference</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Zebra Serial Protocol Specification</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="zebra-serial-protocol-specification">
<h1>Zebra Serial Protocol Specification<a class="headerlink" href="#zebra-serial-protocol-specification" title="Link to this heading">#</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p>This document specifies the serial communication protocol used to control and monitor the Zebra.</p>
</section>
<section id="connection-parameters">
<h2>Connection Parameters<a class="headerlink" href="#connection-parameters" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Baud Rate</strong>: 115200</p></li>
<li><p><strong>Data Bits</strong>: 8</p></li>
<li><p><strong>Parity</strong>: None</p></li>
<li><p><strong>Stop Bits</strong>: 1</p></li>
<li><p><strong>Flow Control</strong>: None</p></li>
<li><p><strong>Line Terminator</strong>: <code class="docutils literal notranslate"><span class="pre">\n</span></code> (newline, 0x0A)</p></li>
</ul>
</section>
<section id="protocol-characteristics">
<h2>Protocol Characteristics<a class="headerlink" href="#protocol-characteristics" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Request-Response</strong>: The protocol is primarily request-response based</p></li>
<li><p><strong>Asynchronous Events</strong>: The device can send unsolicited interrupt messages (position compare data)</p></li>
<li><p><strong>Text-Based</strong>: All commands and responses are ASCII text</p></li>
<li><p><strong>Case-Sensitive</strong>: Commands use uppercase letters and hexadecimal notation</p></li>
</ul>
</section>
<section id="command-format">
<h2>Command Format<a class="headerlink" href="#command-format" title="Link to this heading">#</a></h2>
<p>All commands are terminated with a newline character (<code class="docutils literal notranslate"><span class="pre">\n</span></code>).</p>
<section id="read-register-command">
<h3>1. Read Register Command<a class="headerlink" href="#read-register-command" title="Link to this heading">#</a></h3>
<p><strong>Format</strong>: <code class="docutils literal notranslate"><span class="pre">R&lt;AA&gt;\n</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">R</span></code> - Read command identifier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;AA&gt;</span></code> - 2-digit hexadecimal register address (00-FF)</p></li>
</ul>
<p><strong>Response</strong>: <code class="docutils literal notranslate"><span class="pre">R&lt;AA&gt;&lt;VVVV&gt;\n</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">R&lt;AA&gt;</span></code> - Echo of register address</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;VVVV&gt;</span></code> - 4-digit hexadecimal value (0000-FFFF, representing 16-bit value)</p></li>
</ul>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Command</span><span class="p">:</span>  <span class="n">R88</span>\<span class="n">n</span>
<span class="n">Response</span><span class="p">:</span> <span class="n">R880003</span>\<span class="n">n</span>
</pre></div>
</div>
<p>This reads register 0x88 (PC_ENC) and receives value 0x0003.</p>
<p><strong>Error Response</strong>: <code class="docutils literal notranslate"><span class="pre">E1R&lt;AA&gt;\n</span></code></p>
<ul class="simple">
<li><p>Indicates the register address is invalid or cannot be read</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="write-register-command">
<h3>2. Write Register Command<a class="headerlink" href="#write-register-command" title="Link to this heading">#</a></h3>
<p><strong>Format</strong>: <code class="docutils literal notranslate"><span class="pre">W&lt;AA&gt;&lt;VVVV&gt;\n</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">W</span></code> - Write command identifier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;AA&gt;</span></code> - 2-digit hexadecimal register address (00-FF)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;VVVV&gt;</span></code> - 4-digit hexadecimal value to write (0000-FFFF)</p></li>
</ul>
<p><strong>Response</strong>: <code class="docutils literal notranslate"><span class="pre">W&lt;AA&gt;OK\n</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">W&lt;AA&gt;</span></code> - Echo of register address</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OK</span></code> - Success indicator</p></li>
</ul>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Command</span><span class="p">:</span>  <span class="n">W88001F</span>\<span class="n">n</span>
<span class="n">Response</span><span class="p">:</span> <span class="n">W88OK</span>\<span class="n">n</span>
</pre></div>
</div>
<p>This writes value 0x001F to register 0x88 (PC_ENC).</p>
<p><strong>Error Response</strong>: <code class="docutils literal notranslate"><span class="pre">E1W&lt;AA&gt;\n</span></code></p>
<ul class="simple">
<li><p>Indicates the register address is invalid or cannot be written</p></li>
</ul>
<p><strong>Note</strong>: Read-only registers (type <code class="docutils literal notranslate"><span class="pre">regRO</span></code>) will reject write commands.</p>
</section>
<hr class="docutils" />
<section id="flash-storage-commands">
<h3>3. Flash Storage Commands<a class="headerlink" href="#flash-storage-commands" title="Link to this heading">#</a></h3>
<section id="save-to-flash">
<h4>Save to Flash<a class="headerlink" href="#save-to-flash" title="Link to this heading">#</a></h4>
<p><strong>Format</strong>: <code class="docutils literal notranslate"><span class="pre">S\n</span></code></p>
<p><strong>Response</strong>: <code class="docutils literal notranslate"><span class="pre">SOK\n</span></code></p>
<p><strong>Purpose</strong>: Saves the current register configuration to non-volatile flash memory.</p>
<p><strong>Note</strong>: This command may take ~100ms to complete.</p>
</section>
<section id="load-from-flash">
<h4>Load from Flash<a class="headerlink" href="#load-from-flash" title="Link to this heading">#</a></h4>
<p><strong>Format</strong>: <code class="docutils literal notranslate"><span class="pre">L\n</span></code></p>
<p><strong>Response</strong>: <code class="docutils literal notranslate"><span class="pre">LOK\n</span></code></p>
<p><strong>Purpose</strong>: Restores register configuration from non-volatile flash memory.</p>
</section>
</section>
<hr class="docutils" />
<section id="generic-error-response">
<h3>4. Generic Error Response<a class="headerlink" href="#generic-error-response" title="Link to this heading">#</a></h3>
<p><strong>Format</strong>: <code class="docutils literal notranslate"><span class="pre">E0\n</span></code></p>
<p><strong>Purpose</strong>: Indicates a malformed or unrecognized command.</p>
</section>
</section>
<hr class="docutils" />
<section id="interrupt-messages-asynchronous">
<h2>Interrupt Messages (Asynchronous)<a class="headerlink" href="#interrupt-messages-asynchronous" title="Link to this heading">#</a></h2>
<p>The Zebra sends unsolicited messages when position compare events occur. These messages are distinguished by starting with the letter <code class="docutils literal notranslate"><span class="pre">P</span></code>.</p>
<section id="position-compare-reset-message">
<h3>Position Compare Reset Message<a class="headerlink" href="#position-compare-reset-message" title="Link to this heading">#</a></h3>
<p><strong>Format</strong>: <code class="docutils literal notranslate"><span class="pre">PR\n</span></code></p>
<p><strong>Meaning</strong>: Position compare has been armed. The host should reset its data buffers and prepare to receive position compare data.</p>
<p><strong>Trigger</strong>: Sent when register <code class="docutils literal notranslate"><span class="pre">PC_ARM</span></code> (0x8B) is written with value 1.</p>
</section>
<hr class="docutils" />
<section id="position-compare-data-message">
<h3>Position Compare Data Message<a class="headerlink" href="#position-compare-data-message" title="Link to this heading">#</a></h3>
<p><strong>Format</strong>: <code class="docutils literal notranslate"><span class="pre">P&lt;TTTTTTTT&gt;[&lt;EEEEEEEE&gt;]...\n</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">P</span></code> - Interrupt message identifier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;TTTTTTTT&gt;</span></code> - 8-digit hexadecimal timestamp (32-bit unsigned)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[&lt;EEEEEEEE&gt;]...</span></code> - Zero or more 8-digit hexadecimal encoder/data values (32-bit signed for encoders, unsigned for system bus)</p></li>
</ul>
<p><strong>Timestamp Encoding</strong>:</p>
<ul class="simple">
<li><p>The timestamp is a 32-bit counter incremented at (50MHz / prescaler)</p></li>
<li><p>The prescaler is set via register <code class="docutils literal notranslate"><span class="pre">PC_TSPRE</span></code> (0x89)</p>
<ul>
<li><p>Prescaler = 5: Each count = 0.1 µs (time units in 0.01 ms increments)</p></li>
<li><p>Prescaler = 5000: Each count = 100 µs (time units in 0.01 s increments)</p></li>
</ul>
</li>
<li><p>When the counter rolls over at 2^32, add 429496.7296 time units to maintain continuity</p></li>
</ul>
<p><strong>Data Fields</strong>:
The number and meaning of data fields depends on register <code class="docutils literal notranslate"><span class="pre">PC_BIT_CAP</span></code> (0x9F):</p>
<ul class="simple">
<li><p>Bit 0: Encoder 1 (signed 32-bit, encoder counts)</p></li>
<li><p>Bit 1: Encoder 2 (signed 32-bit, encoder counts)</p></li>
<li><p>Bit 2: Encoder 3 (signed 32-bit, encoder counts)</p></li>
<li><p>Bit 3: Encoder 4 (signed 32-bit, encoder counts)</p></li>
<li><p>Bit 4: System Bus 1 (unsigned 32-bit, bit field)</p></li>
<li><p>Bit 5: System Bus 2 (unsigned 32-bit, bit field)</p></li>
<li><p>Bit 6: Divider 1 output count (unsigned 32-bit)</p></li>
<li><p>Bit 7: Divider 2 output count (unsigned 32-bit)</p></li>
<li><p>Bit 8: Divider 3 output count (unsigned 32-bit)</p></li>
<li><p>Bit 9: Divider 4 output count (unsigned 32-bit)</p></li>
</ul>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PC_BIT_CAP</span> <span class="o">=</span> <span class="mh">0x0013</span> <span class="p">(</span><span class="n">bits</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span> <span class="nb">set</span><span class="p">)</span>
<span class="n">Message</span><span class="p">:</span> <span class="n">P00012A3000001234FFFF5678AB000000</span>\<span class="n">n</span>

<span class="n">Parsed</span><span class="p">:</span>
  <span class="n">Timestamp</span><span class="p">:</span> <span class="mh">0x00012A30</span> <span class="p">(</span><span class="mi">76336</span> <span class="o">*</span> <span class="mf">0.0001</span> <span class="o">=</span> <span class="mf">7.6336</span> <span class="n">time</span> <span class="n">units</span><span class="p">)</span>
  <span class="n">Encoder</span> <span class="mi">1</span><span class="p">:</span> <span class="mh">0x00001234</span> <span class="p">(</span><span class="mi">4660</span> <span class="n">counts</span><span class="p">)</span>
  <span class="n">Encoder</span> <span class="mi">2</span><span class="p">:</span> <span class="mh">0xFFFF5678</span> <span class="p">(</span><span class="o">-</span><span class="mi">43400</span> <span class="n">counts</span><span class="p">,</span> <span class="n">signed</span><span class="p">)</span>
  <span class="n">Sys</span> <span class="n">Bus</span> <span class="mi">1</span><span class="p">:</span> <span class="mh">0xAB000000</span> <span class="p">(</span><span class="n">bits</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">24</span> <span class="nb">set</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="position-compare-complete-message">
<h3>Position Compare Complete Message<a class="headerlink" href="#position-compare-complete-message" title="Link to this heading">#</a></h3>
<p><strong>Format</strong>: <code class="docutils literal notranslate"><span class="pre">PX\n</span></code></p>
<p><strong>Meaning</strong>: Position compare acquisition has completed. No more data will be sent.</p>
<p><strong>Trigger</strong>: Sent when:</p>
<ul class="simple">
<li><p>Register <code class="docutils literal notranslate"><span class="pre">PC_DISARM</span></code> (0x8C) is written with value 1, OR</p></li>
<li><p>The configured number of pulses has been generated and captured</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="register-map">
<h2>Register Map<a class="headerlink" href="#register-map" title="Link to this heading">#</a></h2>
<p>The Zebra has a 256-byte register space (addresses 0x00-0xFF). Each register is 16 bits wide.</p>
<section id="register-types">
<h3>Register Types<a class="headerlink" href="#register-types" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p><strong>regRW</strong>: Read-Write register (configuration)</p></li>
<li><p><strong>regRO</strong>: Read-Only register (status/version)</p></li>
<li><p><strong>regCmd</strong>: Command register (write-only, triggers actions)</p></li>
<li><p><strong>regMux</strong>: Multiplexer register (selects from system bus, see System Bus section)</p></li>
</ol>
</section>
<section id="key-register-categories">
<h3>Key Register Categories<a class="headerlink" href="#key-register-categories" title="Link to this heading">#</a></h3>
<section id="logic-gates-and-or">
<h4>Logic Gates (AND/OR)<a class="headerlink" href="#logic-gates-and-or" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0x00-0x07</span></code>: AND gate 1-4 inversion and enable bits</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x08-0x17</span></code>: AND gate 1-4 inputs (4 inputs × 4 gates)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x18-0x1F</span></code>: OR gate 1-4 inversion and enable bits</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x20-0x2F</span></code>: OR gate 1-4 inputs (4 inputs × 4 gates)</p></li>
</ul>
</section>
<section id="gate-generator">
<h4>Gate Generator<a class="headerlink" href="#gate-generator" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0x30-0x33</span></code>: GATE 1-4 input 1 (trigger)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x34-0x37</span></code>: GATE 1-4 input 2 (reset)</p></li>
</ul>
</section>
<section id="pulse-dividers">
<h4>Pulse Dividers<a class="headerlink" href="#pulse-dividers" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0x38-0x3F</span></code>: DIV 1-4 divisor (LO/HI pairs for 32-bit values)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x40-0x43</span></code>: DIV 1-4 input select</p></li>
</ul>
</section>
<section id="pulse-generators">
<h4>Pulse Generators<a class="headerlink" href="#pulse-generators" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0x44-0x47</span></code>: PULSE 1-4 delay</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x48-0x4B</span></code>: PULSE 1-4 width</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x4C-0x4F</span></code>: PULSE 1-4 prescaler</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x50-0x53</span></code>: PULSE 1-4 input select</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x54</span></code>: POLARITY - Output polarity control</p></li>
</ul>
</section>
<section id="quadrature-encoder">
<h4>Quadrature Encoder<a class="headerlink" href="#quadrature-encoder" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0x55</span></code>: QUAD_DIR - Direction input</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x56</span></code>: QUAD_STEP - Step input</p></li>
</ul>
</section>
<section id="position-compare-control">
<h4>Position Compare Control<a class="headerlink" href="#position-compare-control" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0x57</span></code>: PC_ARM_INP - External arm input select</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x58</span></code>: PC_GATE_INP - External gate input select</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x59</span></code>: PC_PULSE_INP - External pulse input select</p></li>
</ul>
</section>
<section id="output-multiplexers">
<h4>Output Multiplexers<a class="headerlink" href="#output-multiplexers" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0x60-0x7B</span></code>: Output channel routing (28 outputs × 1 register each)</p>
<ul>
<li><p>OUT1-4: Multiple output types per connector (TTL, NIM, LVDS, PECL, OC)</p></li>
<li><p>OUT5-8: Encoder outputs (ENCA, ENCB, ENCZ, CONN enable)</p></li>
</ul>
</li>
</ul>
</section>
<section id="system-control">
<h4>System Control<a class="headerlink" href="#system-control" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0x7C</span></code>: DIV_FIRST - Select first pulse behavior for dividers</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x7E</span></code>: SYS_RESET - System reset command</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x7F</span></code>: SOFT_IN - Software input register (4 bits for SOFT_IN1-4)</p></li>
</ul>
</section>
<section id="position-compare-parameters">
<h4>Position Compare Parameters<a class="headerlink" href="#position-compare-parameters" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0x80-0x87</span></code>: POS1-4 SET (LO/HI pairs) - Load encoder counters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x88</span></code>: PC_ENC - Select which encoder to use for position compare</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x89</span></code>: PC_TSPRE - Timestamp clock prescaler (5=milliseconds, 5000=seconds)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x8A</span></code>: PC_ARM_SEL - Arm input source (0=software, 1=external)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x8B</span></code>: PC_ARM - Software arm command</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x8C</span></code>: PC_DISARM - Software disarm command</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x8D</span></code>: PC_GATE_SEL - Gate source (0=position, 1=time, 2=external)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x8E-0x95</span></code>: PC_GATE parameters (START, WID, NGATE, STEP - all LO/HI pairs)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x96</span></code>: PC_PULSE_SEL - Pulse source (0=position, 1=time, 2=external)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x97-0x9E</span></code>: PC_PULSE parameters (START, WID, STEP, MAX - all LO/HI pairs)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x9F</span></code>: PC_BIT_CAP - Bit mask for data capture (which encoders/divs/sysbus)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0xA0</span></code>: PC_DIR - Position compare direction</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0xA1-0xA2</span></code>: PC_PULSE_DLY (LO/HI) - Pulse delay</p></li>
</ul>
</section>
<section id="status-registers-read-only">
<h4>Status Registers (Read-Only)<a class="headerlink" href="#status-registers-read-only" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0xF0</span></code>: SYS_VER - Firmware version</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0xF1</span></code>: SYS_STATERR - System state/error flags</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0xF2-0xF3</span></code>: SYS_STAT1 (LO/HI) - System bus status bits 0-31</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0xF4-0xF5</span></code>: SYS_STAT2 (LO/HI) - System bus status bits 32-63</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0xF6-0xF7</span></code>: PC_NUM_CAP (LO/HI) - Number of position compare captures</p></li>
</ul>
<p><strong>Note</strong>: Registers with “LO/HI” pairs represent 32-bit values:</p>
<ul class="simple">
<li><p>LO register contains bits 0-15</p></li>
<li><p>HI register contains bits 16-31</p></li>
<li><p>Combined value = (HI &lt;&lt; 16) | LO</p></li>
</ul>
</section>
</section>
</section>
<hr class="docutils" />
<section id="system-bus">
<h2>System Bus<a class="headerlink" href="#system-bus" title="Link to this heading">#</a></h2>
<p>The System Bus is a 64-signal routing matrix that connects inputs, logic gates, and outputs. Each signal has an index (0-63) and a name.</p>
<section id="system-bus-signal-index">
<h3>System Bus Signal Index<a class="headerlink" href="#system-bus-signal-index" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Signal Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>DISCONNECT</p></td>
<td><p>No connection</p></td>
</tr>
<tr class="row-odd"><td><p>1-3</p></td>
<td><p>IN1_TTL, IN1_NIM, IN1_LVDS</p></td>
<td><p>Input 1 variants</p></td>
</tr>
<tr class="row-even"><td><p>4-6</p></td>
<td><p>IN2_TTL, IN2_NIM, IN2_LVDS</p></td>
<td><p>Input 2 variants</p></td>
</tr>
<tr class="row-odd"><td><p>7-9</p></td>
<td><p>IN3_TTL, IN3_OC, IN3_LVDS</p></td>
<td><p>Input 3 variants</p></td>
</tr>
<tr class="row-even"><td><p>10-12</p></td>
<td><p>IN4_TTL, IN4_CMP, IN4_PECL</p></td>
<td><p>Input 4 variants</p></td>
</tr>
<tr class="row-odd"><td><p>13-16</p></td>
<td><p>IN5_ENCA/B/Z, IN5_CONN</p></td>
<td><p>Encoder input 5</p></td>
</tr>
<tr class="row-even"><td><p>17-20</p></td>
<td><p>IN6_ENCA/B/Z, IN6_CONN</p></td>
<td><p>Encoder input 6</p></td>
</tr>
<tr class="row-odd"><td><p>21-24</p></td>
<td><p>IN7_ENCA/B/Z, IN7_CONN</p></td>
<td><p>Encoder input 7</p></td>
</tr>
<tr class="row-even"><td><p>25-28</p></td>
<td><p>IN8_ENCA/B/Z, IN8_CONN</p></td>
<td><p>Encoder input 8</p></td>
</tr>
<tr class="row-odd"><td><p>29-31</p></td>
<td><p>PC_ARM, PC_GATE, PC_PULSE</p></td>
<td><p>Position compare signals</p></td>
</tr>
<tr class="row-even"><td><p>32-35</p></td>
<td><p>AND1, AND2, AND3, AND4</p></td>
<td><p>AND gate outputs</p></td>
</tr>
<tr class="row-odd"><td><p>36-39</p></td>
<td><p>OR1, OR2, OR3, OR4</p></td>
<td><p>OR gate outputs</p></td>
</tr>
<tr class="row-even"><td><p>40-43</p></td>
<td><p>GATE1, GATE2, GATE3, GATE4</p></td>
<td><p>Gate generator outputs</p></td>
</tr>
<tr class="row-odd"><td><p>44-47</p></td>
<td><p>DIV1-4_OUTD</p></td>
<td><p>Divider outputs (divided)</p></td>
</tr>
<tr class="row-even"><td><p>48-51</p></td>
<td><p>DIV1-4_OUTN</p></td>
<td><p>Divider outputs (not divided)</p></td>
</tr>
<tr class="row-odd"><td><p>52-55</p></td>
<td><p>PULSE1, PULSE2, PULSE3, PULSE4</p></td>
<td><p>Pulse generator outputs</p></td>
</tr>
<tr class="row-even"><td><p>56-57</p></td>
<td><p>QUAD_OUTA, QUAD_OUTB</p></td>
<td><p>Quadrature encoder outputs</p></td>
</tr>
<tr class="row-odd"><td><p>58-59</p></td>
<td><p>CLOCK_1KHZ, CLOCK_1MHZ</p></td>
<td><p>Internal clocks</p></td>
</tr>
<tr class="row-even"><td><p>60-63</p></td>
<td><p>SOFT_IN1, SOFT_IN2, SOFT_IN3, SOFT_IN4</p></td>
<td><p>Software inputs</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="using-multiplexer-registers">
<h3>Using Multiplexer Registers<a class="headerlink" href="#using-multiplexer-registers" title="Link to this heading">#</a></h3>
<p>When writing to a <code class="docutils literal notranslate"><span class="pre">regMux</span></code> type register:</p>
<ul class="simple">
<li><p>Write the index (0-63) of the desired system bus signal</p></li>
<li><p>Example: To route IN1_TTL to OUT1_TTL:</p>
<ul>
<li><p>OUT1_TTL is register 0x60</p></li>
<li><p>IN1_TTL has system bus index 1</p></li>
<li><p>Command: <code class="docutils literal notranslate"><span class="pre">W600001\n</span></code></p></li>
</ul>
</li>
</ul>
</section>
<section id="reading-system-bus-status">
<h3>Reading System Bus Status<a class="headerlink" href="#reading-system-bus-status" title="Link to this heading">#</a></h3>
<p>The current state of all 64 system bus signals can be read from registers:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SYS_STAT1LO</span></code> (0xF2): Bits 0-15 of signals 0-31</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SYS_STAT1HI</span></code> (0xF3): Bits 16-31 of signals 0-31</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SYS_STAT2LO</span></code> (0xF4): Bits 0-15 of signals 32-63</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SYS_STAT2HI</span></code> (0xF5): Bits 16-31 of signals 32-63</p></li>
</ul>
<p>To read signal N:</p>
<ol class="arabic simple">
<li><p>Determine register: <code class="docutils literal notranslate"><span class="pre">SYS_STAT1LO/HI</span></code> for N&lt;32, <code class="docutils literal notranslate"><span class="pre">SYS_STAT2LO/HI</span></code> for N≥32</p></li>
<li><p>Determine bit offset: N % 16</p></li>
<li><p>Read register and check bit: <code class="docutils literal notranslate"><span class="pre">(value</span> <span class="pre">&gt;&gt;</span> <span class="pre">bit_offset)</span> <span class="pre">&amp;</span> <span class="pre">1</span></code></p></li>
</ol>
</section>
</section>
<hr class="docutils" />
<section id="typical-usage-sequences">
<h2>Typical Usage Sequences<a class="headerlink" href="#typical-usage-sequences" title="Link to this heading">#</a></h2>
<section id="connect-and-read-firmware-version">
<h3>1. Connect and Read Firmware Version<a class="headerlink" href="#connect-and-read-firmware-version" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>→ R F0
← R F0 0020
</pre></div>
</div>
<p>Firmware version is 0x0020.</p>
</section>
<section id="configure-a-simple-logic-gate">
<h3>2. Configure a Simple Logic Gate<a class="headerlink" href="#configure-a-simple-logic-gate" title="Link to this heading">#</a></h3>
<p>Route IN1_TTL through AND1 gate to OUT1_TTL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>→ W08 0001    # AND1_INP1 = IN1_TTL (index 1)
← W08OK
→ W04 0001    # AND1_ENA = enable input 1 only
← W04OK
→ W00 0000    # AND1_INV = don&#39;t invert
← W00OK
→ W60 0020    # OUT1_TTL = AND1 (index 32)
← W60OK
</pre></div>
</div>
</section>
<section id="configure-position-compare-acquisition">
<h3>3. Configure Position Compare Acquisition<a class="headerlink" href="#configure-position-compare-acquisition" title="Link to this heading">#</a></h3>
<p>Setup to capture encoder 1 position at 1kHz:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>→ W8C 0001    # PC_DISARM (clear any previous state)
← W8COK
→ W9F 0001    # PC_BIT_CAP = bit 0 (capture encoder 1)
← W9FOK
→ W89 1388    # PC_TSPRE = 5000 (for seconds units)
← W89OK
→ W88 0000    # PC_ENC = 0 (use encoder 1)
← W88OK
→ W8D 0001    # PC_GATE_SEL = 1 (time-based gate)
← W8DOK
→ W8E 0000    # PC_GATE_STARTLO = 0
← W8EOK
→ W8F 0000    # PC_GATE_STARTHI = 0
← W8FOK
→ W90 03E8    # PC_GATE_WIDLO = 1000 (1 second at 1kHz)
← W90OK
→ W91 0000    # PC_GATE_WIDHI = 0
← W91OK
→ W96 0001    # PC_PULSE_SEL = 1 (time-based pulse)
← W96OK
→ W97 0000    # PC_PULSE_STARTLO = 0
← W97OK
→ W98 0000    # PC_PULSE_STARTHI = 0
← W98OK
→ W99 0001    # PC_PULSE_WIDLO = 1 (minimal width)
← W99OK
→ W9A 0000    # PC_PULSE_WIDHI = 0
← W9AOK
→ W9B 000A    # PC_PULSE_STEPLO = 10 (10ms between pulses = 100Hz)
← W9BOK
→ W9C 0000    # PC_PULSE_STEPHI = 0
← W9COK
→ W8B 0001    # PC_ARM (start acquisition)
← W8BOK
← PR          # Unsolicited: buffers reset
← P00000000 12345678   # Data: time=0, enc1=0x12345678
← P0000000A 12345680   # Data: time=10ms, enc1=0x12345680
...
← PX          # Unsolicited: acquisition complete
</pre></div>
</div>
</section>
<section id="poll-status-registers">
<h3>4. Poll Status Registers<a class="headerlink" href="#poll-status-registers" title="Link to this heading">#</a></h3>
<p>Typical polling sequence for fast-changing values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>→ RF1         # Read SYS_STATERR
← RF1 0000
→ RF2         # Read SYS_STAT1LO
← RF2 00A3
→ RF3         # Read SYS_STAT1HI
← RF3 0000
→ RF4         # Read SYS_STAT2LO
← RF4 1200
→ RF5         # Read SYS_STAT2HI
← RF5 0001
→ RF6         # Read PC_NUM_CAPLO
← RF6 00C8
→ RF7         # Read PC_NUM_CAPHI
← RF7 0000
</pre></div>
</div>
<p>Result: 200 (0x00C8) position compare captures have occurred.</p>
</section>
<section id="save-configuration-to-flash">
<h3>5. Save Configuration to Flash<a class="headerlink" href="#save-configuration-to-flash" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>→ S
← SOK
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="error-handling">
<h2>Error Handling<a class="headerlink" href="#error-handling" title="Link to this heading">#</a></h2>
<section id="timeouts">
<h3>Timeouts<a class="headerlink" href="#timeouts" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>If no response is received within a reasonable timeout (1-10 seconds), the connection may be lost</p></li>
<li><p>The driver should attempt to reconnect or alert the user</p></li>
<li><p>During flash operations (S, L), allow longer timeouts (~100-200ms)</p></li>
</ul>
</section>
<section id="error-responses">
<h3>Error Responses<a class="headerlink" href="#error-responses" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">E0</span></code> - Malformed command: Check command syntax</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">E1R&lt;AA&gt;</span></code> - Read error: Register may not exist or is not readable</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">E1W&lt;AA&gt;</span></code> - Write error: Register may not exist, is read-only, or value is invalid</p></li>
</ul>
</section>
<section id="connection-loss-detection">
<h3>Connection Loss Detection<a class="headerlink" href="#connection-loss-detection" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Failed writes or timeouts indicate disconnection</p></li>
<li><p>Implementation should track connection state and notify when lost/restored</p></li>
</ul>
</section>
<section id="message-queue-overflow">
<h3>Message Queue Overflow<a class="headerlink" href="#message-queue-overflow" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>The host must process interrupt messages quickly to avoid buffer overflow</p></li>
<li><p>If messages arrive faster than they can be processed, some may be dropped</p></li>
<li><p>Implementation should use a sufficiently large queue (e.g., 10,000 messages)</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="implementation-considerations-for-fastcs-driver">
<h2>Implementation Considerations for FastCS Driver<a class="headerlink" href="#implementation-considerations-for-fastcs-driver" title="Link to this heading">#</a></h2>
<section id="threading-model">
<h3>Threading Model<a class="headerlink" href="#threading-model" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p><strong>Read Thread</strong>: Continuously reads from serial port, dispatching messages to:</p>
<ul class="simple">
<li><p>Response queue (for <code class="docutils literal notranslate"><span class="pre">R</span></code>, <code class="docutils literal notranslate"><span class="pre">W</span></code>, <code class="docutils literal notranslate"><span class="pre">S</span></code>, <code class="docutils literal notranslate"><span class="pre">L</span></code> responses)</p></li>
<li><p>Interrupt queue (for <code class="docutils literal notranslate"><span class="pre">P</span></code> messages)</p></li>
</ul>
</li>
<li><p><strong>Poll Thread</strong>: Periodically reads status registers (at ~4Hz recommended)</p>
<ul class="simple">
<li><p>Fast registers (0xF1-0xF7): Every iteration</p></li>
<li><p>Slow registers (configuration): Every 4th iteration</p></li>
<li><p>Use non-blocking reads (send multiple R commands, then collect responses)</p></li>
</ul>
</li>
<li><p><strong>Interrupt Thread</strong>: Processes position compare data from interrupt queue</p>
<ul class="simple">
<li><p>Parses <code class="docutils literal notranslate"><span class="pre">P</span></code> messages</p></li>
<li><p>Updates NDArray or equivalent data structures</p></li>
<li><p>Handles <code class="docutils literal notranslate"><span class="pre">PR</span></code> (reset) and <code class="docutils literal notranslate"><span class="pre">PX</span></code> (complete) events</p></li>
</ul>
</li>
</ol>
</section>
<section id="register-synchronization">
<h3>Register Synchronization<a class="headerlink" href="#register-synchronization" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>After writing a configuration register, read it back to get the actual value</p></li>
<li><p>Some registers are command-type and don’t return a value</p></li>
<li><p>Handle 32-bit registers by writing/reading LO then HI components</p></li>
</ul>
</section>
<section id="system-bus-mapping">
<h3>System Bus Mapping<a class="headerlink" href="#system-bus-mapping" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Maintain bidirectional lookup: index ↔ name</p></li>
<li><p>When reading <code class="docutils literal notranslate"><span class="pre">regMux</span></code> registers, translate index to name for display</p></li>
<li><p>When writing <code class="docutils literal notranslate"><span class="pre">regMux</span></code> registers, translate name to index</p></li>
</ul>
</section>
<section id="position-compare-data-processing">
<h3>Position Compare Data Processing<a class="headerlink" href="#position-compare-data-processing" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Parse <code class="docutils literal notranslate"><span class="pre">PC_BIT_CAP</span></code> to determine which fields are present in <code class="docutils literal notranslate"><span class="pre">P</span></code> messages</p></li>
<li><p>Handle timestamp rollover by detecting backwards time jumps</p></li>
<li><p>Apply scaling and offset transformations to encoder values</p></li>
<li><p>Encoder values are <strong>signed</strong> 32-bit integers (use two’s complement)</p></li>
<li><p>System bus and divider values are <strong>unsigned</strong> 32-bit integers</p></li>
</ul>
</section>
<section id="configuration-files">
<h3>Configuration Files<a class="headerlink" href="#configuration-files" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Support reading/writing INI-format configuration files</p></li>
<li><p>Use 4-phase process for robust configuration upload:</p>
<ol class="arabic simple">
<li><p>Send all W commands</p></li>
<li><p>Collect all W responses</p></li>
<li><p>Send all R commands (verification)</p></li>
<li><p>Collect all R responses and verify values match</p></li>
</ol>
</li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="protocol-limitations">
<h2>Protocol Limitations<a class="headerlink" href="#protocol-limitations" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><strong>No Command Pipelining</strong>: Each write command must wait for its <code class="docutils literal notranslate"><span class="pre">OK</span></code> response before sending the next (except during batch operations)</p></li>
<li><p><strong>Fixed Baud Rate</strong>: 115200 is hardcoded in firmware</p></li>
<li><p><strong>No Flow Control</strong>: Host must manage message queues to prevent overflow</p></li>
<li><p><strong>No Checksums</strong>: Protocol has no built-in error detection beyond command format validation</p></li>
<li><p><strong>Limited Error Information</strong>: Error codes don’t provide detailed failure reasons</p></li>
<li><p><strong>Interrupt Priority</strong>: Interrupt messages (<code class="docutils literal notranslate"><span class="pre">P</span></code>) are interleaved with command responses on the same serial stream</p></li>
</ol>
</section>
<hr class="docutils" />
<section id="revision-history">
<h2>Revision History<a class="headerlink" href="#revision-history" title="Link to this heading">#</a></h2>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Date</p></th>
<th class="head"><p>Author</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1.0</p></td>
<td><p>2025-12-08</p></td>
<td><p>Auto-generated</p></td>
<td><p>Initial specification from zebra driver source code</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<hr class="docutils" />
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Source: <a class="reference external" href="https://github.com/DiamondLightSource/zebra/blob/84b69dbcc0e085586f799246813e439bea337477/zebraApp/src/zebra.cpp"><code class="docutils literal notranslate"><span class="pre">zebra.cpp</span></code></a></p></li>
<li><p>Source: <a class="reference external" href="https://github.com/DiamondLightSource/zebra/blob/84b69dbcc0e085586f799246813e439bea337477/zebraApp/src/zebraRegs.h"><code class="docutils literal notranslate"><span class="pre">zebraRegs.h</span></code></a></p></li>
<li><p>Source: <a class="reference external" href="https://github.com/DiamondLightSource/zebra/blob/84b69dbcc0e085586f799246813e439bea337477/zebraApp/src/zebraTool.py"><code class="docutils literal notranslate"><span class="pre">zebraTool.py</span></code></a></p></li>
<li><p>Source: <a class="reference external" href="https://github.com/DiamondLightSource/zebra/blob/84b69dbcc0e085586f799246813e439bea337477/zebraApp/src/zebra_sim.py"><code class="docutils literal notranslate"><span class="pre">zebra_sim.py</span></code></a></p></li>
</ul>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../reference.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Reference</p>
      </div>
    </a>
    <a class="right-next"
       href="epics-pv-spec.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Zebra EPICS PV Interface Specification</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#connection-parameters">Connection Parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#protocol-characteristics">Protocol Characteristics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#command-format">Command Format</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#read-register-command">1. Read Register Command</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#write-register-command">2. Write Register Command</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#flash-storage-commands">3. Flash Storage Commands</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#save-to-flash">Save to Flash</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#load-from-flash">Load from Flash</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generic-error-response">4. Generic Error Response</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#interrupt-messages-asynchronous">Interrupt Messages (Asynchronous)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#position-compare-reset-message">Position Compare Reset Message</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#position-compare-data-message">Position Compare Data Message</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#position-compare-complete-message">Position Compare Complete Message</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#register-map">Register Map</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#register-types">Register Types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-register-categories">Key Register Categories</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#logic-gates-and-or">Logic Gates (AND/OR)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#gate-generator">Gate Generator</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pulse-dividers">Pulse Dividers</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pulse-generators">Pulse Generators</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#quadrature-encoder">Quadrature Encoder</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#position-compare-control">Position Compare Control</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#output-multiplexers">Output Multiplexers</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#system-control">System Control</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#position-compare-parameters">Position Compare Parameters</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#status-registers-read-only">Status Registers (Read-Only)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#system-bus">System Bus</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#system-bus-signal-index">System Bus Signal Index</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-multiplexer-registers">Using Multiplexer Registers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-system-bus-status">Reading System Bus Status</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#typical-usage-sequences">Typical Usage Sequences</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#connect-and-read-firmware-version">1. Connect and Read Firmware Version</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-a-simple-logic-gate">2. Configure a Simple Logic Gate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-position-compare-acquisition">3. Configure Position Compare Acquisition</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#poll-status-registers">4. Poll Status Registers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#save-configuration-to-flash">5. Save Configuration to Flash</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#error-handling">Error Handling</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#timeouts">Timeouts</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#error-responses">Error Responses</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#connection-loss-detection">Connection Loss Detection</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#message-queue-overflow">Message Queue Overflow</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation-considerations-for-fastcs-driver">Implementation Considerations for FastCS Driver</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#threading-model">Threading Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#register-synchronization">Register Synchronization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#system-bus-mapping">System Bus Mapping</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#position-compare-data-processing">Position Compare Data Processing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-files">Configuration Files</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#protocol-limitations">Protocol Limitations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#revision-history">Revision History</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/DiamondLightSource/fastcs-zebra/edit/main/docs/reference/serial-protocol.md">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/reference/serial-protocol.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>