<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 520" width="700" height="520">
  <defs>
    <style>
      .box { fill: #f5f5f5; stroke: #666; stroke-width: 1.5; }
      .code { font-family: 'Courier New', monospace; font-size: 11px; }
      .text { font-family: Arial, sans-serif; font-size: 13px; }
      .label { font-family: Arial, sans-serif; font-size: 12px; font-style: italic; fill: #666; }
      .arrow { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .step-box { fill: #e3f2fd; stroke: #1976d2; stroke-width: 1.5; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333" />
    </marker>
  </defs>

  <text class="text" x="10" y="20" font-weight="bold" font-size="16">Connection Lifecycle</text>

  <!-- Step 1 -->
  <rect class="step-box" x="30" y="40" width="640" height="30" rx="3" />
  <text class="code" x="40" y="60">1. Create ZebraTransport and connect to serial port</text>

  <line class="arrow" x1="350" y1="70" x2="350" y2="95" />

  <!-- Step 2 -->
  <rect class="step-box" x="30" y="100" width="640" height="30" rx="3" />
  <text class="code" x="40" y="120">2. Create ZebraProtocol with transport</text>

  <line class="arrow" x1="350" y1="130" x2="350" y2="155" />

  <!-- Step 3 -->
  <rect class="step-box" x="30" y="160" width="640" height="30" rx="3" />
  <text class="code" x="40" y="180">3. Update ZebraRegisterIO with protocol instance</text>

  <line class="arrow" x1="350" y1="190" x2="350" y2="215" />

  <!-- Step 4 -->
  <rect class="step-box" x="30" y="220" width="640" height="30" rx="3" />
  <text class="code" x="40" y="240">4. Register interrupt handler callbacks</text>

  <line class="arrow" x1="350" y1="250" x2="350" y2="275" />

  <!-- Step 5 -->
  <rect class="step-box" x="30" y="280" width="640" height="30" rx="3" />
  <text class="code" x="40" y="300">5. Start interrupt monitoring background task</text>

  <line class="arrow" x1="350" y1="310" x2="350" y2="335" />

  <!-- Step 6 -->
  <rect class="step-box" x="30" y="340" width="640" height="30" rx="3" />
  <text class="code" x="40" y="360">6. Update connection status PVs</text>

  <line class="arrow" x1="350" y1="370" x2="350" y2="395" />

  <!-- Result -->
  <rect class="box" x="30" y="400" width="640" height="100" rx="5" />
  <text class="text" x="40" y="425" font-weight="bold">Result:</text>
  <text class="code" x="40" y="445">• Serial connection established (hardware or simulator)</text>
  <text class="code" x="40" y="465">• Register I/O ready for FastCS attribute updates</text>
  <text class="code" x="40" y="485">• Interrupt monitoring active for position compare data</text>
</svg>
