<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 620 730" width="620" height="730">
  <defs>
    <style>
      .box { fill: #f0f0f0; stroke: #333; stroke-width: 2; }
      .epics { fill: #e3f2fd; }
      .controller { fill: #fff3e0; }
      .io { fill: #f3e5f5; }
      .protocol { fill: #e8f5e9; }
      .transport { fill: #fce4ec; }
      .hardware { fill: #e0f2f1; }
      .text { font-family: Arial, sans-serif; font-size: 14px; text-anchor: middle; }
      .small-text { font-family: Arial, sans-serif; font-size: 12px; text-anchor: middle; }
      .title { font-weight: bold; font-size: 16px; }
      .arrow { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .line { stroke: #333; stroke-width: 2; fill: none; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333" />
    </marker>
  </defs>

  <!-- EPICS Layer -->
  <rect class="box epics" x="60" y="30" width="500" height="60" rx="5" />
  <text class="text title" x="310" y="55">EPICS PVs (Channel Access/PVA)</text>
  <text class="small-text" x="310" y="75">(FastCS Layer)</text>

  <!-- Arrow down -->
  <line class="arrow" x1="310" y1="90" x2="310" y2="120" />

  <!-- ZebraController -->
  <rect class="box controller" x="60" y="130" width="500" height="90" rx="5" />
  <text class="text title" x="310" y="155">ZebraController</text>
  <text class="small-text" x="310" y="175">- Attribute definitions (AttrR, AttrRW)</text>
  <text class="small-text" x="310" y="192">- Command methods</text>
  <text class="small-text" x="310" y="209">- Interrupt handler callbacks</text>

  <!-- Arrow down splits to two boxes -->
  <line class="line" x1="310" y1="220" x2="310" y2="250" />
  <line class="line" x1="310" y1="250" x2="190" y2="250" />
  <line class="line" x1="310" y1="250" x2="430" y2="250" />
  <line class="arrow" x1="190" y1="250" x2="190" y2="290" />
  <line class="arrow" x1="430" y1="250" x2="430" y2="290" />

  <!-- ZebraRegisterIO -->
  <rect class="box io" x="60" y="300" width="260" height="80" rx="5" />
  <text class="text title" x="190" y="325">ZebraRegisterIO</text>
  <text class="small-text" x="190" y="345">- Read registers</text>
  <text class="small-text" x="190" y="362">- Write registers</text>

  <!-- InterruptHandler -->
  <rect class="box io" x="340" y="300" width="240" height="80" rx="5" />
  <text class="text title" x="460" y="325">InterruptHandler</text>
  <text class="small-text" x="460" y="345">- Parse P messages</text>
  <text class="small-text" x="460" y="362">- Callbacks</text>

  <!-- Arrows converge from two boxes -->
  <line class="line" x1="190" y1="380" x2="190" y2="410" />
  <line class="line" x1="460" y1="380" x2="460" y2="410" />
  <line class="line" x1="190" y1="410" x2="310" y2="410" />
  <line class="line" x1="460" y1="410" x2="310" y2="410" />
  <line class="arrow" x1="310" y1="410" x2="310" y2="460" />

  <!-- ZebraProtocol -->
  <rect class="box protocol" x="150" y="470" width="320" height="60" rx="5" />
  <text class="text title" x="310" y="495">ZebraProtocol</text>
  <text class="small-text" x="310" y="515">- R/W commands - Flash ops</text>

  <!-- Arrow down -->
  <line class="arrow" x1="310" y1="530" x2="310" y2="570" />

  <!-- ZebraTransport -->
  <rect class="box transport" x="150" y="580" width="320" height="60" rx="5" />
  <text class="text title" x="310" y="605">ZebraTransport</text>
  <text class="small-text" x="310" y="625">- Serial I/O - Simulator</text>

  <!-- Arrow down -->
  <line class="arrow" x1="310" y1="640" x2="310" y2="670" />

  <!-- Hardware -->
  <rect class="box hardware" x="180" y="680" width="260" height="40" rx="5" />
  <text class="text title" x="310" y="705">Serial Hardware or Simulator</text>
</svg>
